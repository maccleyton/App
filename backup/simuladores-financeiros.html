<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simuladores Financeiros</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS VARIABLES - Design System */
        :root {
            /* Color System */
            --color-primary-100: #E6F5F1;
            --color-primary-500: #019875;
            --color-primary-700: #017A5E;
            --color-bg-page: #0A0A0A;
            --color-bg-surface: #141414;
            --color-bg-surface-hover: rgba(22, 22, 22, 0.5);
            --color-border-default: #3f3f46;
            --color-border-focus: #019875;
            --color-border-light: #262626;
            --color-text-primary: #E4E4E7;
            --color-text-secondary: #A1A1AA;
            --color-text-high-contrast: #FFFFFF;
            --color-success: #22C55E;
            --color-warning: #FBBF24;
            --color-error: #F43F5E;

            /* Typography */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-size-h1: 48px;
            --font-size-h2: 24px;
            --font-size-h3: 16px;
            --font-size-body: 16px;
            --font-size-body-sm: 14px;
            --font-weight-regular: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;

            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* GLOBAL STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: var(--color-bg-page);
            color: var(--color-text-primary);
            font-size: var(--font-size-body);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-xl) var(--spacing-lg);
        }

        /* HEADER */
        .header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .header h1 {
            font-size: var(--font-size-h1);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-high-contrast);
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-100));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--color-text-secondary);
            font-size: var(--font-size-body);
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            border-bottom: 1px solid var(--color-border-light);
            overflow-x: auto;
        }

        .tab-button {
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            padding: var(--spacing-md) var(--spacing-lg);
            font-size: var(--font-size-body-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }

        .tab-button:hover {
            color: var(--color-text-primary);
        }

        .tab-button.active {
            color: var(--color-primary-500);
            border-bottom-color: var(--color-primary-500);
        }

        /* TAB CONTENT */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CARDS */
        .card {
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }

        .card-title {
            font-size: var(--font-size-h2);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-high-contrast);
            margin-bottom: var(--spacing-lg);
        }

        /* FORM ELEMENTS */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-size: var(--font-size-body-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: var(--spacing-md);
            background: var(--color-bg-page);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            font-size: var(--font-size-body);
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--color-border-focus);
            box-shadow: 0 0 0 3px rgba(1, 152, 117, 0.1);
        }

        .form-helper {
            display: block;
            margin-top: var(--spacing-xs);
            font-size: var(--font-size-body-sm);
            color: var(--color-text-secondary);
        }

        /* RADIO BUTTONS */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--color-primary-500);
        }

        .radio-option label {
            color: var(--color-text-primary);
            cursor: pointer;
        }

        /* CHECKBOX */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--color-primary-500);
        }

        /* BUTTON */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md) var(--spacing-xl);
            background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-700));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-body);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--color-bg-page);
            border: 1px solid var(--color-border-default);
            color: var(--color-text-primary);
        }

        /* RESULTS */
        .results {
            display: none;
            margin-top: var(--spacing-xl);
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .result-item {
            background: var(--color-bg-page);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
        }

        .result-label {
            font-size: var(--font-size-body-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .result-value {
            font-size: var(--font-size-h2);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary-500);
        }

        /* TABLE */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border-default);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--color-bg-page);
        }

        th {
            padding: var(--spacing-md);
            text-align: left;
            font-size: var(--font-size-body-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-secondary);
            border-bottom: 1px solid var(--color-border-default);
        }

        td {
            padding: var(--spacing-md);
            font-size: var(--font-size-body-sm);
            color: var(--color-text-primary);
            border-bottom: 1px solid var(--color-border-light);
        }

        tbody tr:hover {
            background: var(--color-bg-surface-hover);
        }

        /* GRID LAYOUTS */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }

            .card {
                padding: var(--spacing-lg);
            }

            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>Simuladores Financeiros</h1>
            <p>Ferramentas completas para análise de investimentos e operações de crédito</p>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('investimentos')">Investimentos</button>
            <button class="tab-button" onclick="openTab('desconto')">Desconto Comercial</button>
            <button class="tab-button" onclick="openTab('conversor')">Conversor de Taxas</button>
            <button class="tab-button" onclick="openTab('credito')">Operações de Crédito</button>
        </div>

        <!-- TAB: INVESTIMENTOS -->
        <div id="investimentos" class="tab-content active">
            <div class="card">
                <h2 class="card-title">Simulador de Investimentos</h2>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Valor do Investimento (R$)</label>
                        <input type="number" id="valorInvestimento" class="form-input" placeholder="10000.00" step="0.01">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tipo de Taxa</label>
                        <select id="tipoTaxa" class="form-select" onchange="updateTaxaFields()">
                            <option value="">Selecione...</option>
                            <option value="CDI">CDI</option>
                            <option value="SELIC">SELIC</option>
                            <option value="IPCA">IPCA</option>
                            <option value="CDI+">CDI+</option>
                            <option value="SELIC+">SELIC+</option>
                            <option value="IPCA+">IPCA+</option>
                            <option value="Prefixada">Prefixada</option>
                        </select>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group" id="taxaBaseGroup" style="display: none;">
                        <label class="form-label">Taxa Base (% a.a.)</label>
                        <input type="number" id="taxaBase" class="form-input" placeholder="100" step="0.01">
                        <small class="form-helper">CDI: 14,9% | SELIC: 15,00% | IPCA: 5.20%</small>
                    </div>

                    <div class="form-group" id="flexGroup" style="display: none;">
                        <label class="form-label">Flex (%)</label>
                        <input type="number" id="flex" class="form-input" placeholder="100" step="0.01">
                    </div>

                    <div class="form-group" id="spreadGroup" style="display: none;">
                        <label class="form-label">Spread</label>
                        <input type="number" id="spread" class="form-input" placeholder="0.5" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Data de Vencimento</label>
                    <input type="date" id="dataVencimento" class="form-input">
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="isentoIR">
                        <label for="isentoIR">Isento de Imposto de Renda (selecione se aplicável)</label>
                    </div>
                    <small class="form-helper">A alíquota será calculada automaticamente com base no prazo</small>
                </div>

                <button class="btn" onclick="calcularInvestimento()">Calcular Investimento</button>

                <div id="investimentoResults" class="results">
                    <h3 class="card-title">Resultados do Investimento</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">Taxa Real</div>
                            <div class="result-value" id="taxaReal">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Valor Bruto</div>
                            <div class="result-value" id="valorBruto">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Rendimento</div>
                            <div class="result-value" id="rendimento">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">IOF</div>
                            <div class="result-value" id="iof">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">IRRF</div>
                            <div class="result-value" id="irrf">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Valor Líquido</div>
                            <div class="result-value" id="valorLiquido">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: DESCONTO COMERCIAL -->
        <div id="desconto" class="tab-content">
            <div class="card">
                <h2 class="card-title">Desconto Comercial</h2>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Valor Nominal do Título (R$)</label>
                        <input type="number" id="valorNominal" class="form-input" placeholder="10000.00" step="0.01">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Data de Vencimento</label>
                        <input type="date" id="dataVencimentoDesconto" class="form-input">
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Taxa de Desconto (% a.m.)</label>
                        <input type="number" id="taxaDesconto" class="form-input" placeholder="2.5" step="0.01">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tarifas Adicionais (R$)</label>
                        <input type="number" id="tarifasAdicionais" class="form-input" placeholder="0.00" step="0.01" value="0">
                    </div>
                </div>

                <button class="btn" onclick="calcularDesconto()">Calcular Desconto</button>

                <div id="descontoResults" class="results">
                    <h3 class="card-title">Resultados do Desconto</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">Prazo Médio (dias)</div>
                            <div class="result-value" id="prazoMedio">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Juros/Custos</div>
                            <div class="result-value" id="jurosCustos">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">IOF Fixo</div>
                            <div class="result-value" id="iofFixo">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">IOF Adicional</div>
                            <div class="result-value" id="iofAdicional">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Valor Descontado</div>
                            <div class="result-value" id="valorDescontado">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: CONVERSOR DE TAXAS -->
        <div id="conversor" class="tab-content">
            <div class="card">
                <h2 class="card-title">Conversor de Taxas</h2>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Taxa de Entrada (%)</label>
                        <input type="number" id="taxaEntrada" class="form-input" placeholder="10.5" step="0.01">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Período de Origem</label>
                        <select id="periodoOrigem" class="form-select">
                            <option value="diario">Diário</option>
                            <option value="semanal">Semanal</option>
                            <option value="mensal" selected>Mensal</option>
                            <option value="bimestral">Bimestral</option>
                            <option value="trimestral">Trimestral</option>
                            <option value="semestral">Semestral</option>
                            <option value="anual">Anual</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Período de Destino</label>
                    <select id="periodoDestino" class="form-select">
                        <option value="diario">Diário</option>
                        <option value="semanal">Semanal</option>
                        <option value="mensal">Mensal</option>
                        <option value="bimestral">Bimestral</option>
                        <option value="trimestral">Trimestral</option>
                        <option value="semestral">Semestral</option>
                        <option value="anual" selected>Anual</option>
                    </select>
                </div>

                <button class="btn" onclick="converterTaxas()">Converter Taxa</button>

                <div id="conversorResults" class="results">
                    <h3 class="card-title">Taxas Convertidas</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">Taxa Convertida</div>
                            <div class="result-value" id="taxaConvertida">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Equivalente Mensal</div>
                            <div class="result-value" id="equivalenteMensal">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Equivalente Anual</div>
                            <div class="result-value" id="equivalenteAnual">-</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Período</th>
                                    <th>Taxa Equivalente</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaConversao"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: OPERAÇÕES DE CRÉDITO -->
        <div id="credito" class="tab-content">
            <div class="card">
                <h2 class="card-title">Operações de Crédito Unificadas</h2>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Valor Financiado (R$)</label>
                        <input type="number" id="creditValue" class="form-input" placeholder="100000.00" step="0.01">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tipo de Amortização</label>
                        <select id="amortizationType" class="form-select">
                            <option value="SAC">SAC (Sistema de Amortização Constante)</option>
                            <option value="PRICE">PRICE (Sistema Price)</option>
                        </select>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Dia Base</label>
                        <select id="baseDay" class="form-select">
                            <option value="1">1º dia do mês</option>
                            <option value="15">15º dia do mês</option>
                            <option value="30">Último dia do mês</option>
                            <option value="contratacao" selected>Data de contratação</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Carência (meses)</label>
                        <select id="gracePeriod" class="form-select">
                            <option value="0" selected>0</option>
                            <option value="3">3</option>
                            <option value="6">6</option>
                            <option value="9">9</option>
                            <option value="12">12</option>
                            <option value="15">15</option>
                            <option value="18">18</option>
                            <option value="21">21</option>
                            <option value="24">24</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Juros na Carência</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="interestYes" name="interestOnGrace" value="yes" checked>
                            <label for="interestYes">Sim - Calcular juros na carência</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="interestNo" name="interestOnGrace" value="no">
                            <label for="interestNo">Não - Não calcular juros na carência</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Forma de Cobrança (quando sem juros na carência)</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="chargeFirst" name="interestCharge" value="first" checked>
                            <label for="chargeFirst">Cobrar na primeira parcela</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="chargeDiluted" name="interestCharge" value="amortization">
                            <label for="chargeDiluted">Diluído nas parcelas de amortização</label>
                        </div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Amortização</label>
                        <select id="amortizationFrequency" class="form-select">
                            <option value="mensal" selected>Mensal</option>
                            <option value="bimestral">Bimestral</option>
                            <option value="trimestral">Trimestral</option>
                            <option value="semestral">Semestral</option>
                            <option value="anual">Anual</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Prazo Total (meses)</label>
                        <select id="totalTerm" class="form-select">
                            <option value="12">12</option>
                            <option value="24">24</option>
                            <option value="36" selected>36</option>
                            <option value="48">48</option>
                            <option value="60">60</option>
                            <option value="72">72</option>
                            <option value="84">84</option>
                            <option value="96">96</option>
                            <option value="108">108</option>
                            <option value="120">120</option>
                        </select>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">TAC - Tarifa de Contratação (R$)</label>
                        <input type="number" id="tac" class="form-input" placeholder="0.00" step="0.01" value="0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">FLAT - Comissão (R$)</label>
                        <input type="number" id="flatCommission" class="form-input" placeholder="0.00" step="0.01" value="0">
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Taxa (% a.m.)</label>
                        <input type="number" id="interestRate" class="form-input" placeholder="1.5" step="0.01">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Sobretaxa (% a.m.)</label>
                        <input type="number" id="surchargeRate" class="form-input" placeholder="0" step="0.01" value="0">
                    </div>
                </div>

                <button class="btn" onclick="calculateCredit()">Calcular Operação</button>

                <div id="creditResults" class="results">
                    <h3 class="card-title">Resultados do Financiamento</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">CET Mensal</div>
                            <div class="result-value" id="cetMensal">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">CET Anual</div>
                            <div class="result-value" id="cetAnual">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Total de Juros</div>
                            <div class="result-value" id="totalJuros">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Valor Total Pago</div>
                            <div class="result-value" id="totalPago">-</div>
                        </div>
                    </div>

                    <button class="btn btn-secondary" onclick="exportarCronograma()">Exportar Cronograma</button>

                    <div class="table-container" style="margin-top: var(--spacing-lg);">
                        <table>
                            <thead>
                                <tr>
                                    <th>Parcela</th>
                                    <th>Data de Vencimento</th>
                                    <th>Amortização</th>
                                    <th>Juros</th>
                                    <th>Valor da Parcela</th>
                                    <th>Saldo Devedor</th>
                                </tr>
                            </thead>
                            <tbody id="cronograma"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GLOBAL VARIABLES
        let currentSchedule = [];

        // TAB NAVIGATION
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // INVESTIMENTOS - Update Taxa Fields
        function updateTaxaFields() {
            const tipoTaxa = document.getElementById('tipoTaxa').value;
            const taxaBaseGroup = document.getElementById('taxaBaseGroup');
            const flexGroup = document.getElementById('flexGroup');
            const spreadGroup = document.getElementById('spreadGroup');

            // Reset
            taxaBaseGroup.style.display = 'none';
            flexGroup.style.display = 'none';
            spreadGroup.style.display = 'none';

            if (tipoTaxa.includes('+')) {
                taxaBaseGroup.style.display = 'block';
                flexGroup.style.display = 'block';
                spreadGroup.style.display = 'block';
            } else if (tipoTaxa && tipoTaxa !== 'Prefixada') {
                flexGroup.style.display = 'block';
            } else if (tipoTaxa === 'Prefixada') {
                taxaBaseGroup.style.display = 'block';
            }
        }

        // INVESTIMENTOS - Calcular
        function calcularInvestimento() {
            const valorInvestimento = parseFloat(document.getElementById('valorInvestimento').value);
            const tipoTaxa = document.getElementById('tipoTaxa').value;
            const dataVencimento = new Date(document.getElementById('dataVencimento').value);
            const isentoIR = document.getElementById('isentoIR').checked;

            if (!valorInvestimento || !tipoTaxa || !dataVencimento) {
                alert('Preencha todos os campos obrigatórios');
                return;
            }

            // Calcular prazo em dias
            const hoje = new Date();
            const prazo = Math.floor((dataVencimento - hoje) / (1000 * 60 * 60 * 24));

            // Determinar taxa real
            let taxaReal = 0;
            const taxasBase = { CDI: 14.9, SELIC: 15.0, IPCA: 5.2 };

            if (tipoTaxa === 'Prefixada') {
                taxaReal = parseFloat(document.getElementById('taxaBase').value) || 0;
            } else if (tipoTaxa.includes('+')) {
                const base = tipoTaxa.replace('+', '');
                const taxaBaseValor = taxasBase[base];
                const flex = parseFloat(document.getElementById('flex').value) || 100;
                const spread = parseFloat(document.getElementById('spread').value) || 0;
                taxaReal = (taxaBaseValor * flex / 100) + spread;
            } else {
                const flex = parseFloat(document.getElementById('flex').value) || 100;
                taxaReal = taxasBase[tipoTaxa] * flex / 100;
            }

            // Calcular rendimento bruto
            const taxaDiaria = Math.pow(1 + taxaReal / 100, 1 / 252) - 1;
            const fatorRendimento = Math.pow(1 + taxaDiaria, prazo);
            const valorBruto = valorInvestimento * fatorRendimento;
            const rendimento = valorBruto - valorInvestimento;

            // Calcular IOF (regressivo para operações < 30 dias)
            let iof = 0;
            if (prazo < 30) {
                const tabelaIOF = [96, 93, 90, 86, 83, 80, 76, 73, 70, 66, 63, 60, 56, 53, 50, 46, 43, 40, 36, 33, 30, 26, 23, 20, 16, 13, 10, 6, 3, 0];
                const aliquotaIOF = prazo < tabelaIOF.length ? tabelaIOF[prazo] : 0;
                iof = rendimento * (aliquotaIOF / 100);
            }

            // Calcular IR (progressivo)
            let ir = 0;
            if (!isentoIR) {
                let aliquotaIR = 0;
                if (prazo <= 180) aliquotaIR = 22.5;
                else if (prazo <= 360) aliquotaIR = 20;
                else if (prazo <= 720) aliquotaIR = 17.5;
                else aliquotaIR = 15;
                
                ir = rendimento * (aliquotaIR / 100);
            }

            const valorLiquido = valorBruto - iof - ir;

            // Atualizar resultados
            document.getElementById('taxaReal').textContent = taxaReal.toFixed(2) + '% a.a.';
            document.getElementById('valorBruto').textContent = formatCurrency(valorBruto);
            document.getElementById('rendimento').textContent = formatCurrency(rendimento);
            document.getElementById('iof').textContent = formatCurrency(iof);
            document.getElementById('irrf').textContent = formatCurrency(ir);
            document.getElementById('valorLiquido').textContent = formatCurrency(valorLiquido);

            document.getElementById('investimentoResults').style.display = 'block';
        }

        // DESCONTO COMERCIAL - Calcular
        function calcularDesconto() {
            const valorNominal = parseFloat(document.getElementById('valorNominal').value);
            const dataVencimento = new Date(document.getElementById('dataVencimentoDesconto').value);
            const taxaDesconto = parseFloat(document.getElementById('taxaDesconto').value) / 100;
            const tarifas = parseFloat(document.getElementById('tarifasAdicionais').value) || 0;

            if (!valorNominal || !dataVencimento || !taxaDesconto) {
                alert('Preencha todos os campos obrigatórios');
                return;
            }

            // Calcular prazo em dias
            const hoje = new Date();
            const prazo = Math.floor((dataVencimento - hoje) / (1000 * 60 * 60 * 24));

            // Desconto comercial: D = N × i × n
            const descontoComercial = valorNominal * taxaDesconto * (prazo / 30);
            
            // IOF para operações de crédito
            const iofFixo = 0.0038 * valorNominal; // 0.38%
            const iofAdicional = 0.000082 * valorNominal * prazo; // 0.0082% ao dia
            
            const valorDescontado = valorNominal - descontoComercial - iofFixo - iofAdicional - tarifas;

            // Atualizar resultados
            document.getElementById('prazoMedio').textContent = prazo + ' dias';
            document.getElementById('jurosCustos').textContent = formatCurrency(descontoComercial);
            document.getElementById('iofFixo').textContent = formatCurrency(iofFixo);
            document.getElementById('iofAdicional').textContent = formatCurrency(iofAdicional);
            document.getElementById('valorDescontado').textContent = formatCurrency(valorDescontado);

            document.getElementById('descontoResults').style.display = 'block';
        }

        // CONVERSOR DE TAXAS - Calcular
        function converterTaxas() {
            const taxaEntrada = parseFloat(document.getElementById('taxaEntrada').value) / 100;
            const periodoOrigem = document.getElementById('periodoOrigem').value;
            const periodoDestino = document.getElementById('periodoDestino').value;

            if (!taxaEntrada || !periodoOrigem || !periodoDestino) {
                alert('Preencha todos os campos');
                return;
            }

            // Períodos em dias
            const periodos = {
                diario: 1,
                semanal: 7,
                mensal: 30,
                bimestral: 60,
                trimestral: 90,
                semestral: 180,
                anual: 360
            };

            // Converter para taxa diária
            const diasOrigem = periodos[periodoOrigem];
            const taxaDiaria = Math.pow(1 + taxaEntrada, 1 / diasOrigem) - 1;

            // Converter para período destino
            const diasDestino = periodos[periodoDestino];
            const taxaConvertida = (Math.pow(1 + taxaDiaria, diasDestino) - 1) * 100;

            // Equivalentes
            const taxaMensal = (Math.pow(1 + taxaDiaria, 30) - 1) * 100;
            const taxaAnual = (Math.pow(1 + taxaDiaria, 360) - 1) * 100;

            // Atualizar resultados
            document.getElementById('taxaConvertida').textContent = taxaConvertida.toFixed(4) + '%';
            document.getElementById('equivalenteMensal').textContent = taxaMensal.toFixed(4) + '% a.m.';
            document.getElementById('equivalenteAnual').textContent = taxaAnual.toFixed(4) + '% a.a.';

            // Gerar tabela de conversão
            const tbody = document.getElementById('tabelaConversao');
            tbody.innerHTML = '';
            
            Object.keys(periodos).forEach(periodo => {
                const dias = periodos[periodo];
                const taxa = (Math.pow(1 + taxaDiaria, dias) - 1) * 100;
                
                const row = tbody.insertRow();
                row.insertCell(0).textContent = periodo.charAt(0).toUpperCase() + periodo.slice(1);
                row.insertCell(1).textContent = taxa.toFixed(4) + '%';
            });

            document.getElementById('conversorResults').style.display = 'block';
        }

        // OPERAÇÕES DE CRÉDITO - Calcular (CORRIGIDO)
        function calculateCredit() {
            const creditValue = parseFloat(document.getElementById('creditValue')?.value) || 0;
            const amortizationType = document.getElementById('amortizationType')?.value;
            const baseDay = document.getElementById('baseDay')?.value;
            const gracePeriod = parseInt(document.getElementById('gracePeriod')?.value) || 0;
            const interestOnGrace = document.querySelector('input[name="interestOnGrace"]:checked')?.value === "yes";
            const interestCharge = document.querySelector('input[name="interestCharge"]:checked')?.value || "first";
            const amortizationFrequency = document.getElementById('amortizationFrequency')?.value;
            const totalTerm = parseInt(document.getElementById('totalTerm')?.value) || 0;
            const tac = parseFloat(document.getElementById('tac')?.value) || 0;
            const flatCommission = parseFloat(document.getElementById('flatCommission')?.value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate')?.value) / 100 || 0;
            const surchargeRate = parseFloat(document.getElementById('surchargeRate')?.value) / 100 || 0;

            if (!creditValue || !amortizationType || !totalTerm || !interestRate) {
                document.getElementById('creditResults').style.display = 'none';
                return;
            }

            const totalRate = interestRate + surchargeRate;
            const amortizationTerm = totalTerm - gracePeriod;

            if (amortizationTerm <= 0) {
                alert('Prazo total deve ser maior que a carência');
                document.getElementById('creditResults').style.display = 'none';
                return;
            }

            const schedule = generatePaymentSchedule({
                creditValue,
                totalRate,
                amortizationType,
                gracePeriod,
                amortizationTerm,
                amortizationFrequency,
                interestOnGrace,
                interestCharge,
                baseDay
            });

            currentSchedule = schedule;

            const totalInterest = schedule.reduce((sum, item) => sum + item.juros, 0);
            const totalPaid = schedule.reduce((sum, item) => sum + item.parcelaValor, 0);

            const cetMonthly = calculateCET(creditValue, totalPaid + tac + flatCommission, totalTerm);
            const cetAnnual = Math.pow(1 + cetMonthly, 12) - 1;

            updateCreditResults({
                cetMonthly,
                cetAnnual,
                totalInterest,
                totalPaid,
                schedule
            });

            document.getElementById('creditResults').style.display = 'block';
        }

        // GERAR CRONOGRAMA DE PAGAMENTOS (CORRIGIDO)
        function generatePaymentSchedule(params) {
            const {
                creditValue,
                totalRate,
                amortizationType,
                gracePeriod,
                amortizationTerm,
                amortizationFrequency,
                interestOnGrace,
                interestCharge,
                baseDay
            } = params;

            let saldoDevedor = creditValue;
            const schedule = [];
            
            let jurosAcumuladosCarencia = 0;
            
            if (!interestOnGrace && gracePeriod > 0) {
                jurosAcumuladosCarencia = creditValue * (Math.pow(1 + totalRate, gracePeriod) - 1);
            }

            const amortizationAmount = amortizationType === 'SAC' ? creditValue / amortizationTerm : null;
            
            let parcelaPRICE = 0;
            if (amortizationType === 'PRICE') {
                let valorBase = creditValue;
                
                if (!interestOnGrace && interestCharge === 'amortization' && gracePeriod > 0) {
                    valorBase = creditValue + jurosAcumuladosCarencia;
                }
                
                parcelaPRICE = valorBase * (totalRate * Math.pow(1 + totalRate, amortizationTerm)) / (Math.pow(1 + totalRate, amortizationTerm) - 1);
            }

            for (let i = 1; i <= (gracePeriod + amortizationTerm); i++) {
                const juros = saldoDevedor * totalRate;
                let amortizacao = 0;
                let parcela = 0;

                if (i <= gracePeriod) {
                    amortizacao = 0;
                    
                    if (interestOnGrace) {
                        parcela = juros;
                    } else {
                        parcela = 0;
                        saldoDevedor += juros;
                    }
                    
                } else {
                    if (i === gracePeriod + 1 && !interestOnGrace && interestCharge === 'first' && gracePeriod > 0) {
                        if (amortizationType === 'SAC') {
                            amortizacao = amortizationAmount;
                            parcela = amortizacao + juros + jurosAcumuladosCarencia;
                        } else {
                            parcela = parcelaPRICE + jurosAcumuladosCarencia;
                            amortizacao = parcela - juros - jurosAcumuladosCarencia;
                        }
                    } else {
                        if (amortizationType === 'SAC') {
                            amortizacao = amortizationAmount;
                            parcela = amortizacao + juros;
                        } else {
                            parcela = parcelaPRICE;
                            amortizacao = parcela - juros;
                        }
                    }
                    
                    saldoDevedor -= amortizacao;
                }

                const vencimentoDate = calculateDueDate(new Date(), i, baseDay);

                schedule.push({
                    numero: i,
                    vencimento: vencimentoDate,
                    amortizacao,
                    juros,
                    parcelaValor: Math.abs(parcela),
                    saldoDevedor: Math.max(0, saldoDevedor)
                });
            }

            return schedule;
        }

        // CALCULAR DATA DE VENCIMENTO
        function calculateDueDate(startDate, installmentNumber, baseDay) {
            const date = new Date(startDate);
            
            if (baseDay === 'contratacao') {
                date.setMonth(date.getMonth() + installmentNumber);
            } else if (baseDay === '1') {
                date.setMonth(date.getMonth() + installmentNumber);
                date.setDate(1);
            } else if (baseDay === '15') {
                date.setMonth(date.getMonth() + installmentNumber);
                date.setDate(15);
            } else if (baseDay === '30') {
                date.setMonth(date.getMonth() + installmentNumber + 1);
                date.setDate(0);
            }
            
            return date;
        }

        // CALCULAR CET
        function calculateCET(principal, totalPaid, months) {
            let cetMonthly = 0;
            let low = -0.1;
            let high = 1;
            const tolerance = 0.0001;
            
            while (high - low > tolerance) {
                cetMonthly = (low + high) / 2;
                const pv = totalPaid / Math.pow(1 + cetMonthly, months);
                
                if (pv > principal) {
                    low = cetMonthly;
                } else {
                    high = cetMonthly;
                }
            }
            
            return cetMonthly;
        }

        // ATUALIZAR RESULTADOS DE CRÉDITO
        function updateCreditResults(data) {
            document.getElementById('cetMensal').textContent = (data.cetMonthly * 100).toFixed(4) + '%';
            document.getElementById('cetAnual').textContent = (data.cetAnnual * 100).toFixed(4) + '%';
            document.getElementById('totalJuros').textContent = formatCurrency(data.totalInterest);
            document.getElementById('totalPago').textContent = formatCurrency(data.totalPaid);

            const tbody = document.getElementById('cronograma');
            tbody.innerHTML = '';
            
            data.schedule.forEach(item => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = item.numero;
                row.insertCell(1).textContent = formatDate(item.vencimento);
                row.insertCell(2).textContent = formatCurrency(item.amortizacao);
                row.insertCell(3).textContent = formatCurrency(item.juros);
                row.insertCell(4).textContent = formatCurrency(item.parcelaValor);
                row.insertCell(5).textContent = formatCurrency(item.saldoDevedor);
            });
        }

        // EXPORTAR CRONOGRAMA
        function exportarCronograma() {
            if (currentSchedule.length === 0) {
                alert('Nenhum cronograma para exportar');
                return;
            }

            let csv = 'Parcela,Data de Vencimento,Amortização,Juros,Valor da Parcela,Saldo Devedor\n';
            
            currentSchedule.forEach(item => {
                csv += `${item.numero},${formatDate(item.vencimento)},${item.amortizacao.toFixed(2)},${item.juros.toFixed(2)},${item.parcelaValor.toFixed(2)},${item.saldoDevedor.toFixed(2)}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cronograma_pagamento.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // UTILITY FUNCTIONS
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('pt-BR');
        }
    </script>
</body>
</html>
