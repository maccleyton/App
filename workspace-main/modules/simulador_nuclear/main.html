<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Decaimento Radioativo</title>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- MathJax -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --color-primary: #DC2626;
            --color-secondary: #F59E0B;
            --color-nuclear: #16A34A;
            --color-bg-page: #0A0A0A;
            --color-bg-surface: #141414;
            --color-border: #3f3f46;
            --color-text-primary: #E4E4E7;
            --color-text-secondary: #A1A1AA;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--color-bg-page) 0%, #1a1a1a 100%);
            color: var(--color-text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        header {
            text-align: center;
            padding: 1.5rem 0;
            border-bottom: 2px solid var(--color-border);
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
            border-radius: 0.75rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 1.1rem;
        }

        /* Cards */
        .card {
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--color-border);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* 3D Viewer */
        .viewer-3d {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.75rem;
            border: 1px solid var(--color-border);
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        /* Chart */
        .chart-container {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            border: 1px solid var(--color-border);
        }

        /* Controls */
        .control-group {
            margin-bottom: 1rem;
        }

        .control-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            margin-bottom: 0.5rem;
        }

        .control-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--color-border);
            border-radius: 0.5rem;
            color: var(--color-text-primary);
            font-size: 0.95rem;
        }

        .control-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        select.control-input {
            cursor: pointer;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: var(--color-border);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--color-primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
        }

        .btn-secondary {
            background: var(--color-bg-surface);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
        }

        .button-group {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--color-border);
            text-align: center;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-top: 0.25rem;
        }

        /* Info Box */
        .info-box {
            background: rgba(220, 38, 38, 0.1);
            border-left: 3px solid var(--color-primary);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .info-box h4 {
            color: var(--color-primary);
            margin-bottom: 0.5rem;
        }

        /* Math Equations */
        .equation-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--color-border);
            margin: 1rem 0;
            text-align: center;
        }

        /* Grid Layout */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        /* Decay Chain */
        .decay-chain {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0.5rem;
            flex-wrap: wrap;
        }

        .decay-element {
            padding: 1rem;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            border-radius: 0.5rem;
            font-weight: 600;
            text-align: center;
            min-width: 80px;
        }

        .decay-arrow {
            font-size: 1.5rem;
            color: var(--color-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--color-bg-surface);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ò¢Ô∏è SIMULADOR DE DECAIMENTO RADIOATIVO</h1>
            <p class="subtitle">Simula√ß√£o de Decaimento Nuclear com 20 Is√≥topos Radioativos</p>
        </header>

        <div class="grid-2">
            <!-- Visualiza√ß√£o 3D -->
            <div class="card">
                <div class="card-header">
                    <span>‚öõÔ∏è</span>
                    <h3 class="card-title">Visualiza√ß√£o 3D do N√∫cleo</h3>
                </div>
                <div class="viewer-3d" id="nucleus-viewer"></div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Pr√≥tons</div>
                        <div class="stat-value" id="proton-count">92</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">N√™utrons</div>
                        <div class="stat-value" id="neutron-count">146</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Massa At√¥mica</div>
                        <div class="stat-value" id="mass-number">238</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Tipo de Radia√ß√£o</div>
                        <div class="stat-value" id="radiation-type">Œ±</div>
                    </div>
                </div>
            </div>

            <!-- Controles -->
            <div class="card">
                <div class="card-header">
                    <span>üéõÔ∏è</span>
                    <h3 class="card-title">Controles da Simula√ß√£o</h3>
                </div>

                <div class="control-group">
                    <label class="control-label">‚ò¢Ô∏è Is√≥topo Radioativo</label>
                    <select class="control-input" id="isotope-select" onchange="updateIsotope()">
                        <optgroup label="Elementos Pesados">
                            <option value="u238" selected>Ur√¢nio-238 (U-238)</option>
                            <option value="u235">Ur√¢nio-235 (U-235)</option>
                            <option value="th232">T√≥rio-232 (Th-232)</option>
                            <option value="ra226">R√°dio-226 (Ra-226)</option>
                            <option value="pu239">Plut√¥nio-239 (Pu-239)</option>
                        </optgroup>
                        <optgroup label="Elementos M√©dios">
                            <option value="co60">Cobalto-60 (Co-60)</option>
                            <option value="cs137">C√©sio-137 (Cs-137)</option>
                            <option value="sr90">Estr√¥ncio-90 (Sr-90)</option>
                            <option value="i131">Iodo-131 (I-131)</option>
                        </optgroup>
                        <optgroup label="Elementos Leves">
                            <option value="c14">Carbono-14 (C-14)</option>
                            <option value="h3">Tr√≠tio (H-3)</option>
                            <option value="na24">S√≥dio-24 (Na-24)</option>
                            <option value="p32">F√≥sforo-32 (P-32)</option>
                        </optgroup>
                        <optgroup label="Gases Nobres">
                            <option value="rn222">Rad√¥nio-222 (Rn-222)</option>
                            <option value="kr85">Cript√¥nio-85 (Kr-85)</option>
                        </optgroup>
                        <optgroup label="Outros">
                            <option value="po210">Pol√¥nio-210 (Po-210)</option>
                            <option value="am241">Amer√≠cio-241 (Am-241)</option>
                            <option value="tc99">Tecn√©cio-99 (Tc-99)</option>
                            <option value="cf252">Calif√≥rnio-252 (Cf-252)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">Quantidade Inicial:</label>
                    <input type="range" id="initial-quantity" min="100" max="10000" value="1000" step="100">
                    <span id="quantity-value">1000 √°tomos</span>
                </div>

                <div class="control-group">
                    <label class="control-label">Velocidade da Simula√ß√£o:</label>
                    <input type="range" id="simulation-speed" min="1" max="10" value="5" step="1">
                    <span id="speed-value">5x</span>
                </div>

                <div class="info-box" id="isotope-info">
                    <h4>Ur√¢nio-238 (U-238)</h4>
                    <p><strong>Meia-vida:</strong> 4.468 bilh√µes de anos</p>
                    <p><strong>Decaimento:</strong> Emiss√£o Œ± ‚Üí T√≥rio-234</p>
                    <p><strong>Energia:</strong> 4.270 MeV</p>
                    <p><strong>Aplica√ß√£o:</strong> Data√ß√£o geol√≥gica, combust√≠vel nuclear</p>
                </div>
            </div>
        </div>

        <!-- Gr√°fico de Decaimento -->
        <div class="card">
            <div class="card-header">
                <span>üìä</span>
                <h3 class="card-title">Gr√°fico de Decaimento Exponencial</h3>
            </div>
            <div class="chart-container">
                <canvas id="decay-chart"></canvas>
            </div>
        </div>

        <!-- Equa√ß√µes e M√©tricas -->
        <div class="grid-2">
            <div class="card">
                <div class="card-header">
                    <span>üìê</span>
                    <h3 class="card-title">Equa√ß√µes do Decaimento</h3>
                </div>

                <div class="equation-box">
                    <h4>Lei do Decaimento Exponencial</h4>
                    <p>$$N(t) = N_0 \cdot e^{-\lambda t}$$</p>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--color-text-secondary);">
                        Onde:<br>
                        \(N(t)\) = Quantidade no tempo t<br>
                        \(N_0\) = Quantidade inicial<br>
                        \(\lambda\) = Constante de decaimento<br>
                        \(t\) = Tempo decorrido
                    </p>
                </div>

                <div class="equation-box">
                    <h4>Meia-vida (Half-life)</h4>
                    <p>$$t_{1/2} = \frac{\ln(2)}{\lambda} = \frac{0.693}{\lambda}$$</p>
                </div>

                <div class="equation-box">
                    <h4>Atividade Radioativa</h4>
                    <p>$$A(t) = \lambda \cdot N(t)$$</p>
                    <p style="margin-top: 0.5rem; font-size: 0.85rem;">Medida em Becquerels (Bq) ou Curies (Ci)</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span>üìà</span>
                    <h3 class="card-title">M√©tricas em Tempo Real</h3>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">√Åtomos Restantes</div>
                        <div class="stat-value" id="atoms-remaining">1000</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">√Åtomos Deca√≠dos</div>
                        <div class="stat-value" id="atoms-decayed">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Tempo Decorrido</div>
                        <div class="stat-value" id="time-elapsed">0 anos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Meias-vidas</div>
                        <div class="stat-value" id="half-lives">0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Atividade</div>
                        <div class="stat-value" id="activity">0 Bq</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Energia Liberada</div>
                        <div class="stat-value" id="energy-released">0 MeV</div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="startSimulation()">‚ñ∂Ô∏è Iniciar Simula√ß√£o</button>
                    <button class="btn btn-secondary" onclick="pauseSimulation()">‚è∏Ô∏è Pausar</button>
                    <button class="btn btn-secondary" onclick="resetSimulation()">üîÑ Reiniciar</button>
                </div>
            </div>
        </div>

        <!-- Cadeia de Decaimento -->
        <div class="card">
            <div class="card-header">
                <span>üîó</span>
                <h3 class="card-title">Cadeia de Decaimento</h3>
            </div>
            <div class="decay-chain" id="decay-chain">
                <div class="decay-element">U-238</div>
                <div class="decay-arrow">Œ± ‚Üí</div>
                <div class="decay-element">Th-234</div>
                <div class="decay-arrow">Œ≤‚Åª ‚Üí</div>
                <div class="decay-element">Pa-234</div>
                <div class="decay-arrow">Œ≤‚Åª ‚Üí</div>
                <div class="decay-element">U-234</div>
                <div class="decay-arrow">Œ± ‚Üí</div>
                <div class="decay-element">...</div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ISOTOPE DATABASE ====================
        const isotopes = {
            u238: {
                name: 'Ur√¢nio-238',
                symbol: 'U-238',
                protons: 92,
                neutrons: 146,
                halfLife: 4.468e9, // years
                decayType: 'Œ±',
                energy: 4.270, // MeV
                decayTo: 'Th-234',
                application: 'Data√ß√£o geol√≥gica, combust√≠vel nuclear',
                chain: ['U-238', 'Th-234', 'Pa-234', 'U-234', 'Th-230', 'Ra-226', 'Rn-222', 'Po-218']
            },
            u235: {
                name: 'Ur√¢nio-235',
                symbol: 'U-235',
                protons: 92,
                neutrons: 143,
                halfLife: 7.04e8,
                decayType: 'Œ±',
                energy: 4.679,
                decayTo: 'Th-231',
                application: 'Reatores nucleares, bombas at√¥micas',
                chain: ['U-235', 'Th-231', 'Pa-231', 'Ac-227', 'Th-227']
            },
            th232: {
                name: 'T√≥rio-232',
                symbol: 'Th-232',
                protons: 90,
                neutrons: 142,
                halfLife: 1.405e10,
                decayType: 'Œ±',
                energy: 4.081,
                decayTo: 'Ra-228',
                application: 'Reatores de t√≥rio, data√ß√£o',
                chain: ['Th-232', 'Ra-228', 'Ac-228', 'Th-228', 'Ra-224']
            },
            ra226: {
                name: 'R√°dio-226',
                symbol: 'Ra-226',
                protons: 88,
                neutrons: 138,
                halfLife: 1600,
                decayType: 'Œ±',
                energy: 4.871,
                decayTo: 'Rn-222',
                application: 'Medicina antiga, fontes de radia√ß√£o',
                chain: ['Ra-226', 'Rn-222', 'Po-218', 'Pb-214', 'Bi-214']
            },
            pu239: {
                name: 'Plut√¥nio-239',
                symbol: 'Pu-239',
                protons: 94,
                neutrons: 145,
                halfLife: 24110,
                decayType: 'Œ±',
                energy: 5.244,
                decayTo: 'U-235',
                application: 'Armas nucleares, combust√≠vel MOX',
                chain: ['Pu-239', 'U-235', 'Th-231', 'Pa-231']
            },
            co60: {
                name: 'Cobalto-60',
                symbol: 'Co-60',
                protons: 27,
                neutrons: 33,
                halfLife: 5.27,
                decayType: 'Œ≤‚Åª',
                energy: 2.823,
                decayTo: 'Ni-60',
                application: 'Radioterapia, esteriliza√ß√£o',
                chain: ['Co-60', 'Ni-60']
            },
            cs137: {
                name: 'C√©sio-137',
                symbol: 'Cs-137',
                protons: 55,
                neutrons: 82,
                halfLife: 30.17,
                decayType: 'Œ≤‚Åª',
                energy: 1.176,
                decayTo: 'Ba-137',
                application: 'Fontes de radia√ß√£o, medicina',
                chain: ['Cs-137', 'Ba-137']
            },
            sr90: {
                name: 'Estr√¥ncio-90',
                symbol: 'Sr-90',
                protons: 38,
                neutrons: 52,
                halfLife: 28.79,
                decayType: 'Œ≤‚Åª',
                energy: 0.546,
                decayTo: 'Y-90',
                application: 'Tratamento √≥sseo, geradores RTG',
                chain: ['Sr-90', 'Y-90', 'Zr-90']
            },
            i131: {
                name: 'Iodo-131',
                symbol: 'I-131',
                protons: 53,
                neutrons: 78,
                halfLife: 0.0219, // 8.02 days
                decayType: 'Œ≤‚Åª',
                energy: 0.971,
                decayTo: 'Xe-131',
                application: 'Tratamento de tireoide',
                chain: ['I-131', 'Xe-131']
            },
            c14: {
                name: 'Carbono-14',
                symbol: 'C-14',
                protons: 6,
                neutrons: 8,
                halfLife: 5730,
                decayType: 'Œ≤‚Åª',
                energy: 0.156,
                decayTo: 'N-14',
                application: 'Data√ß√£o arqueol√≥gica',
                chain: ['C-14', 'N-14']
            },
            h3: {
                name: 'Tr√≠tio',
                symbol: 'H-3',
                protons: 1,
                neutrons: 2,
                halfLife: 12.32,
                decayType: 'Œ≤‚Åª',
                energy: 0.0186,
                decayTo: 'He-3',
                application: 'Rel√≥gios luminosos, fus√£o nuclear',
                chain: ['H-3', 'He-3']
            },
            na24: {
                name: 'S√≥dio-24',
                symbol: 'Na-24',
                protons: 11,
                neutrons: 13,
                halfLife: 0.00171, // 15 hours
                decayType: 'Œ≤‚Åª',
                energy: 5.516,
                decayTo: 'Mg-24',
                application: 'Tra√ßadores m√©dicos',
                chain: ['Na-24', 'Mg-24']
            },
            p32: {
                name: 'F√≥sforo-32',
                symbol: 'P-32',
                protons: 15,
                neutrons: 17,
                halfLife: 0.0391, // 14.3 days
                decayType: 'Œ≤‚Åª',
                energy: 1.709,
                decayTo: 'S-32',
                application: 'Pesquisa biol√≥gica, tratamento c√¢ncer',
                chain: ['P-32', 'S-32']
            },
            rn222: {
                name: 'Rad√¥nio-222',
                symbol: 'Rn-222',
                protons: 86,
                neutrons: 136,
                halfLife: 0.0105, // 3.82 days
                decayType: 'Œ±',
                energy: 5.590,
                decayTo: 'Po-218',
                application: 'Risco em constru√ß√µes',
                chain: ['Rn-222', 'Po-218', 'Pb-214', 'Bi-214', 'Po-214']
            },
            kr85: {
                name: 'Cript√¥nio-85',
                symbol: 'Kr-85',
                protons: 36,
                neutrons: 49,
                halfLife: 10.76,
                decayType: 'Œ≤‚Åª',
                energy: 0.687,
                decayTo: 'Rb-85',
                application: 'Detectores de vazamento',
                chain: ['Kr-85', 'Rb-85']
            },
            po210: {
                name: 'Pol√¥nio-210',
                symbol: 'Po-210',
                protons: 84,
                neutrons: 126,
                halfLife: 0.379, // 138 days
                decayType: 'Œ±',
                energy: 5.407,
                decayTo: 'Pb-206',
                application: 'Fonte de calor, eliminador est√°tico',
                chain: ['Po-210', 'Pb-206']
            },
            am241: {
                name: 'Amer√≠cio-241',
                symbol: 'Am-241',
                protons: 95,
                neutrons: 146,
                halfLife: 432.2,
                decayType: 'Œ±',
                energy: 5.638,
                decayTo: 'Np-237',
                application: 'Detectores de fuma√ßa',
                chain: ['Am-241', 'Np-237', 'Pa-233', 'U-233']
            },
            tc99: {
                name: 'Tecn√©cio-99',
                symbol: 'Tc-99',
                protons: 43,
                neutrons: 56,
                halfLife: 211000,
                decayType: 'Œ≤‚Åª',
                energy: 0.294,
                decayTo: 'Ru-99',
                application: 'Imagens m√©dicas',
                chain: ['Tc-99', 'Ru-99']
            },
            cf252: {
                name: 'Calif√≥rnio-252',
                symbol: 'Cf-252',
                protons: 98,
                neutrons: 154,
                halfLife: 2.645,
                decayType: 'Œ±/SF',
                energy: 6.217,
                decayTo: 'Cm-248',
                application: 'Fonte de n√™utrons, an√°lise de materiais',
                chain: ['Cf-252', 'Cm-248', 'Pu-244']
            }
        };

        // ==================== GLOBAL STATE ====================
        const state = {
            currentIsotope: 'u238',
            initialQuantity: 1000,
            currentQuantity: 1000,
            simulationSpeed: 5,
            time: 0,
            running: false,
            interval: null,
            decayedAtoms: 0,
            totalEnergy: 0
        };

        // Three.js objects
        let scene, camera, renderer, controls;
        let nucleusGroup, radiationParticles = [];

        // Chart
        let decayChart;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            initialize3DViewer();
            initializeChart();
            initializeControls();
            updateIsotope();
            
            // Trigger MathJax rendering
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        });

        function initialize3DViewer() {
            const container = document.getElementById('nucleus-viewer');
            if (!container) return;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);

            camera = new THREE.PerspectiveCamera(
                50,
                container.clientWidth / container.clientHeight,
                0.1,
                1000
            );
            camera.position.set(0, 0, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0x404040, 2);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xDC2626, 2, 100);
            pointLight.position.set(10, 10, 10);
            scene.add(pointLight);

            nucleusGroup = new THREE.Group();
            scene.add(nucleusGroup);

            if (typeof THREE.OrbitControls !== 'undefined') {
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
            }

            createNucleus();
            animate3D();
        }

        function createNucleus() {
            // Clear previous nucleus
            while (nucleusGroup.children.length > 0) {
                nucleusGroup.remove(nucleusGroup.children[0]);
            }

            const isotope = isotopes[state.currentIsotope];
            const protons = isotope.protons;
            const neutrons = isotope.neutrons;

            // Create protons (red)
            for (let i = 0; i < Math.min(protons, 30); i++) {
                const geometry = new THREE.SphereGeometry(0.3, 16, 16);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0xDC2626,
                    shininess: 30
                });
                const proton = new THREE.Mesh(geometry, material);
                
                const phi = Math.acos(-1 + (2 * i) / protons);
                const theta = Math.sqrt(protons * Math.PI) * phi;
                const radius = 3;
                
                proton.position.x = radius * Math.cos(theta) * Math.sin(phi);
                proton.position.y = radius * Math.sin(theta) * Math.sin(phi);
                proton.position.z = radius * Math.cos(phi);
                
                nucleusGroup.add(proton);
            }

            // Create neutrons (blue)
            for (let i = 0; i < Math.min(neutrons, 30); i++) {
                const geometry = new THREE.SphereGeometry(0.3, 16, 16);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x3B82F6,
                    shininess: 30
                });
                const neutron = new THREE.Mesh(geometry, material);
                
                const phi = Math.acos(-1 + (2 * i) / neutrons);
                const theta = Math.sqrt(neutrons * Math.PI) * phi;
                const radius = 3.5;
                
                neutron.position.x = radius * Math.cos(theta) * Math.sin(phi);
                neutron.position.y = radius * Math.sin(theta) * Math.sin(phi);
                neutron.position.z = radius * Math.cos(phi);
                
                nucleusGroup.add(neutron);
            }
        }

        function animate3D() {
            requestAnimationFrame(animate3D);
            
            if (controls) {
                controls.update();
            }
            
            if (nucleusGroup) {
                nucleusGroup.rotation.y += 0.002;
                nucleusGroup.rotation.x += 0.001;
            }

            // Animate radiation particles
            radiationParticles.forEach((particle, index) => {
                particle.position.x += particle.userData.velocity.x;
                particle.position.y += particle.userData.velocity.y;
                particle.position.z += particle.userData.velocity.z;
                particle.material.opacity -= 0.01;

                if (particle.material.opacity <= 0) {
                    scene.remove(particle);
                    radiationParticles.splice(index, 1);
                }
            });
            
            renderer.render(scene, camera);
        }

        function emitRadiation() {
            const isotope = isotopes[state.currentIsotope];
            const geometry = new THREE.SphereGeometry(0.15, 8, 8);
            const color = isotope.decayType.includes('Œ±') ? 0xF59E0B : 0x10B981;
            const material = new THREE.MeshBasicMaterial({ 
                color: color,
                transparent: true,
                opacity: 1
            });
            const particle = new THREE.Mesh(geometry, material);
            
            const angle = Math.random() * Math.PI * 2;
            const elevation = Math.random() * Math.PI - Math.PI / 2;
            
            particle.userData.velocity = {
                x: Math.cos(angle) * Math.cos(elevation) * 0.1,
                y: Math.sin(elevation) * 0.1,
                z: Math.sin(angle) * Math.cos(elevation) * 0.1
            };
            
            scene.add(particle);
            radiationParticles.push(particle);
        }

        function initializeChart() {
            const ctx = document.getElementById('decay-chart').getContext('2d');
            
            decayChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '√Åtomos Restantes',
                        data: [],
                        borderColor: '#DC2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: '√Åtomos Deca√≠dos',
                        data: [],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#E4E4E7'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: '#3f3f46'
                            },
                            ticks: {
                                color: '#A1A1AA'
                            },
                            title: {
                                display: true,
                                text: 'Tempo (anos)',
                                color: '#E4E4E7'
                            }
                        },
                        y: {
                            grid: {
                                color: '#3f3f46'
                            },
                            ticks: {
                                color: '#A1A1AA'
                            },
                            title: {
                                display: true,
                                text: 'N√∫mero de √Åtomos',
                                color: '#E4E4E7'
                            }
                        }
                    }
                }
            });
        }

        function initializeControls() {
            document.getElementById('initial-quantity').addEventListener('input', (e) => {
                state.initialQuantity = parseInt(e.target.value);
                state.currentQuantity = state.initialQuantity;
                document.getElementById('quantity-value').textContent = `${state.initialQuantity} √°tomos`;
                updateMetrics();
            });

            document.getElementById('simulation-speed').addEventListener('input', (e) => {
                state.simulationSpeed = parseInt(e.target.value);
                document.getElementById('speed-value').textContent = `${state.simulationSpeed}x`;
            });
        }

        // ==================== ISOTOPE MANAGEMENT ====================
        function updateIsotope() {
            state.currentIsotope = document.getElementById('isotope-select').value;
            const isotope = isotopes[state.currentIsotope];

            // Update info box
            document.getElementById('isotope-info').innerHTML = `
                <h4>${isotope.name} (${isotope.symbol})</h4>
                <p><strong>Meia-vida:</strong> ${formatHalfLife(isotope.halfLife)}</p>
                <p><strong>Decaimento:</strong> Emiss√£o ${isotope.decayType} ‚Üí ${isotope.decayTo}</p>
                <p><strong>Energia:</strong> ${isotope.energy} MeV</p>
                <p><strong>Aplica√ß√£o:</strong> ${isotope.application}</p>
            `;

            // Update nucleus stats
            document.getElementById('proton-count').textContent = isotope.protons;
            document.getElementById('neutron-count').textContent = isotope.neutrons;
            document.getElementById('mass-number').textContent = isotope.protons + isotope.neutrons;
            document.getElementById('radiation-type').textContent = isotope.decayType;

            // Update decay chain
            updateDecayChain(isotope.chain);

            // Recreate nucleus
            createNucleus();

            // Reset simulation
            if (state.running) {
                pauseSimulation();
            }
            resetSimulation();
        }

        function updateDecayChain(chain) {
            const chainContainer = document.getElementById('decay-chain');
            chainContainer.innerHTML = '';

            chain.forEach((element, index) => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'decay-element';
                elementDiv.textContent = element;
                chainContainer.appendChild(elementDiv);

                if (index < chain.length - 1) {
                    const arrowDiv = document.createElement('div');
                    arrowDiv.className = 'decay-arrow';
                    arrowDiv.textContent = '‚Üí';
                    chainContainer.appendChild(arrowDiv);
                }
            });
        }

        function formatHalfLife(years) {
            if (years >= 1e9) return `${(years / 1e9).toFixed(3)} bilh√µes de anos`;
            if (years >= 1e6) return `${(years / 1e6).toFixed(3)} milh√µes de anos`;
            if (years >= 1000) return `${(years / 1000).toFixed(3)} mil anos`;
            if (years >= 1) return `${years.toFixed(2)} anos`;
            if (years >= 0.002740) return `${(years * 365).toFixed(2)} dias`;
            return `${(years * 365 * 24).toFixed(2)} horas`;
        }

        // ==================== SIMULATION ====================
        function startSimulation() {
            if (state.running) return;

            state.running = true;
            const isotope = isotopes[state.currentIsotope];
            const lambda = Math.log(2) / isotope.halfLife;

            state.interval = setInterval(() => {
                state.time += 0.1 * state.simulationSpeed;

                // Calculate current quantity using exponential decay
                const decayedNow = state.initialQuantity * Math.exp(-lambda * state.time);
                state.currentQuantity = Math.max(0, Math.floor(decayedNow));
                state.decayedAtoms = state.initialQuantity - state.currentQuantity;
                state.totalEnergy = state.decayedAtoms * isotope.energy;

                // Emit radiation particles occasionally
                if (Math.random() < 0.3 && state.currentQuantity > 0) {
                    emitRadiation();
                }

                updateMetrics();
                updateChart();

                // Stop if all atoms decayed
                if (state.currentQuantity <= 0) {
                    pauseSimulation();
                }
            }, 100);
        }

        function pauseSimulation() {
            state.running = false;
            if (state.interval) {
                clearInterval(state.interval);
                state.interval = null;
            }
        }

        function resetSimulation() {
            pauseSimulation();
            state.time = 0;
            state.currentQuantity = state.initialQuantity;
            state.decayedAtoms = 0;
            state.totalEnergy = 0;
            
            // Clear chart
            decayChart.data.labels = [];
            decayChart.data.datasets[0].data = [];
            decayChart.data.datasets[1].data = [];
            decayChart.update();

            updateMetrics();
        }

        function updateMetrics() {
            const isotope = isotopes[state.currentIsotope];
            const lambda = Math.log(2) / isotope.halfLife;
            const halfLives = state.time / isotope.halfLife;
            const activity = lambda * state.currentQuantity;

            document.getElementById('atoms-remaining').textContent = state.currentQuantity.toLocaleString();
            document.getElementById('atoms-decayed').textContent = state.decayedAtoms.toLocaleString();
            document.getElementById('time-elapsed').textContent = formatHalfLife(state.time);
            document.getElementById('half-lives').textContent = halfLives.toFixed(2);
            document.getElementById('activity').textContent = activity.toExponential(2) + ' Bq';
            document.getElementById('energy-released').textContent = state.totalEnergy.toFixed(2) + ' MeV';
        }

        function updateChart() {
            if (decayChart.data.labels.length > 100) {
                decayChart.data.labels.shift();
                decayChart.data.datasets[0].data.shift();
                decayChart.data.datasets[1].data.shift();
            }

            decayChart.data.labels.push(state.time.toFixed(1));
            decayChart.data.datasets[0].data.push(state.currentQuantity);
            decayChart.data.datasets[1].data.push(state.decayedAtoms);
            decayChart.update('none');
        }
    </script>
</body>
</html>
